<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photobooth Strip Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Pacifico&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #f3f4f6;
        }
        
        /* Font Khusus Judul Strip */
        .strip-font {
            font-family: 'Pacifico', cursive;
        }

        /* Pola Background Hiasan CSS */
        .pattern-polka {
            background-image: radial-gradient(#ffffff 20%, transparent 20%);
            background-position: 0 0;
            background-size: 10px 10px;
        }
        
        .pattern-grid {
            background-image: linear-gradient(#ffffff 1px, transparent 1px), linear-gradient(90deg, #ffffff 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* Animasi Flash Kamera */
        @keyframes flash {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }
        .flash-effect {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: white;
            z-index: 50;
            pointer-events: none;
            opacity: 0;
        }
        .flash-active {
            animation: flash 0.5s ease-out;
        }

        /* Styling Video Mirror */
        video {
            transform: scaleX(-1);
        }
        .photo-result {
            transform: scaleX(-1);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center py-10">

    <div id="flash" class="flash-effect"></div>

    <div class="container mx-auto px-4 flex flex-col lg:flex-row gap-8 items-start justify-center">
        
        <div class="w-full lg:w-1/2 flex flex-col gap-6">
            <div class="bg-white p-6 rounded-2xl shadow-xl border-4 border-black">
                <h1 class="text-3xl font-bold mb-4 text-center">üì∏ Photobooth Web</h1>
                
                <div class="relative w-full aspect-[4/3] bg-black rounded-lg overflow-hidden border-2 border-gray-800 mb-4 shadow-inner">
                    <video id="webcam" autoplay playsinline class="w-full h-full object-cover"></video>
                    
                    <div id="countdown" class="hidden absolute inset-0 flex items-center justify-center bg-black/50 text-white text-8xl font-bold">
                        3
                    </div>
                </div>

                <div class="flex flex-col gap-3">
                    <div class="flex gap-2 justify-center mb-2">
                        <button onclick="setTheme('bg-pink-400', 'pattern-polka', 'text-pink-600')" class="w-8 h-8 rounded-full bg-pink-400 border-2 border-white ring-2 ring-gray-300"></button>
                        <button onclick="setTheme('bg-blue-400', 'pattern-grid', 'text-blue-600')" class="w-8 h-8 rounded-full bg-blue-400 border-2 border-white ring-2 ring-gray-300"></button>
                        <button onclick="setTheme('bg-purple-400', 'pattern-polka', 'text-purple-600')" class="w-8 h-8 rounded-full bg-purple-400 border-2 border-white ring-2 ring-gray-300"></button>
                        <button onclick="setTheme('bg-gray-800', '', 'text-black')" class="w-8 h-8 rounded-full bg-gray-800 border-2 border-white ring-2 ring-gray-300"></button>
                    </div>

                    <button id="btn-start" onclick="startPhotobooth()" class="w-full bg-yellow-400 hover:bg-yellow-300 text-black font-bold py-3 px-6 rounded-xl border-b-4 border-yellow-600 active:border-b-0 active:translate-y-1 transition-all">
                        Mulai Foto (3x Shot)
                    </button>

                    <div class="grid grid-cols-2 gap-2">
                         <input type="text" id="custom-text" placeholder="Tulis namamu..." class="border-2 border-gray-300 rounded-lg px-3 py-2 text-center" oninput="updateFooterText(this.value)">
                        <button onclick="resetStrip()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 rounded-lg">
                            Ulang / Reset
                        </button>
                    </div>
                </div>
            </div>

            <div class="text-sm text-gray-500 text-center bg-white p-4 rounded-xl shadow">
                <p>üí° <b>Tips:</b> Gunakan pencahayaan yang terang. Hasil foto akan otomatis tersusun di sebelah kanan.</p>
            </div>
        </div>

        <div class="w-full lg:w-auto flex flex-col items-center">
            
            <div id="photo-strip" class="relative bg-pink-400 pattern-polka p-4 shadow-2xl transition-colors duration-300" style="width: 300px; min-height: 800px;">
                
                <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 w-32 h-6 bg-gray-200/50 backdrop-blur border border-gray-300 rounded-full shadow-sm z-10"></div>

                <div class="bg-white p-3 shadow-sm h-full flex flex-col items-center gap-3 pb-8">
                    <div class="text-center pt-2">
                        <h2 class="strip-font text-3xl text-pink-500 mb-1" id="strip-title">Photobooth</h2>
                        <p class="text-xs text-gray-400 tracking-widest uppercase" id="strip-date">DATE: 00/00/00</p>
                    </div>

                    <div class="flex flex-col gap-3 w-full" id="photo-container">
                        <div class="aspect-[4/3] bg-gray-100 flex items-center justify-center border-2 border-dashed border-gray-300 rounded text-gray-300">1</div>
                        <div class="aspect-[4/3] bg-gray-100 flex items-center justify-center border-2 border-dashed border-gray-300 rounded text-gray-300">2</div>
                        <div class="aspect-[4/3] bg-gray-100 flex items-center justify-center border-2 border-dashed border-gray-300 rounded text-gray-300">3</div>
                    </div>

                    <div class="mt-auto pt-4 text-center">
                         <div class="flex justify-center gap-2 mb-2 text-2xl">
                            <span>‚ú®</span><span>‚úåÔ∏è</span><span>üíñ</span>
                        </div>
                        <p id="footer-text" class="font-bold text-gray-800 text-lg uppercase tracking-wider">MOMENT KITA</p>
                        <div class="w-full h-8 mt-2 bg-black opacity-10" style="background: repeating-linear-gradient(45deg, #000, #000 2px, transparent 2px, transparent 10px);"></div>
                    </div>
                </div>
            </div>

            <button id="btn-download" onclick="downloadStrip()" class="mt-6 w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-6 rounded-xl shadow-lg flex items-center justify-center gap-2 hidden">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
                Download Hasil (.PNG)
            </button>

        </div>
    </div>

    <script>
        const video = document.getElementById('webcam');
        const photoContainer = document.getElementById('photo-container');
        const countdownEl = document.getElementById('countdown');
        const flashEl = document.getElementById('flash');
        const downloadBtn = document.getElementById('btn-download');
        const startBtn = document.getElementById('btn-start');
        
        let stream;
        
        // 1. Inisialisasi Kamera
        async function initCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = stream;
            } catch (err) {
                alert("Gagal mengakses kamera. Pastikan izin kamera aktif!");
                console.error(err);
            }
        }

        // Set Tanggal Hari Ini
        const date = new Date();
        document.getElementById('strip-date').innerText = `DATE: ${date.toLocaleDateString('id-ID')}`;

        // 2. Logika Foto Berurutan
        async function startPhotobooth() {
            // Reset dulu container
            photoContainer.innerHTML = '';
            startBtn.disabled = true;
            startBtn.innerText = "Mengambil Foto...";
            downloadBtn.classList.add('hidden');

            const totalShots = 3;
            
            for (let i = 1; i <= totalShots; i++) {
                await doCountdown(3); // Hitung mundur 3 detik
                const imgData = takeSnapshot();
                addPhotoToStrip(imgData);
                triggerFlash();
                await new Promise(r => setTimeout(r, 1000)); // Jeda antar foto
            }

            startBtn.disabled = false;
            startBtn.innerText = "Mulai Foto Lagi";
            downloadBtn.classList.remove('hidden');
        }

        // Fungsi Hitung Mundur
        function doCountdown(seconds) {
            return new Promise(resolve => {
                countdownEl.classList.remove('hidden');
                let counter = seconds;
                countdownEl.innerText = counter;
                
                const interval = setInterval(() => {
                    counter--;
                    if (counter > 0) {
                        countdownEl.innerText = counter;
                    } else {
                        clearInterval(interval);
                        countdownEl.classList.add('hidden');
                        resolve();
                    }
                }, 1000);
            });
        }

        // Fungsi Capture Gambar dari Video
        function takeSnapshot() {
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            
            // Mirror image agar sesuai preview
            ctx.translate(canvas.width, 0);
            ctx.scale(-1, 1);
            
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            return canvas.toDataURL('image/png');
        }

        // Fungsi Menambahkan Foto ke Strip HTML
        function addPhotoToStrip(imgData) {
            const img = document.createElement('img');
            img.src = imgData;
            img.className = "w-full aspect-[4/3] object-cover border-2 border-black rounded shadow-sm filter grayscale hover:grayscale-0 transition-all duration-500"; 
            // ^ Hapus 'grayscale' di class di atas jika ingin berwarna
            photoContainer.appendChild(img);
        }

        // Efek Flash Putih
        function triggerFlash() {
            flashEl.classList.add('flash-active');
            setTimeout(() => flashEl.classList.remove('flash-active'), 500);
        }

        // 3. Fitur Download (HTML to Canvas)
        function downloadStrip() {
            const element = document.getElementById('photo-strip');
            
            html2canvas(element, { 
                scale: 2, // Resolusi tinggi biar bagus pas dicetak
                useCORS: true 
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `photobooth-${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        // 4. Fitur Hiasan / Kustomisasi
        function setTheme(bgColor, pattern, textColor) {
            const strip = document.getElementById('photo-strip');
            const title = document.getElementById('strip-title');
            
            // Reset class lama
            strip.className = `relative p-4 shadow-2xl transition-colors duration-300 w-[300px] min-h-[800px] ${bgColor} ${pattern}`;
            
            // Ganti warna text judul
            title.className = `strip-font text-3xl mb-1 ${textColor}`;
        }

        function updateFooterText(text) {
            const display = document.getElementById('footer-text');
            display.innerText = text || "MOMENT KITA";
        }

        function resetStrip() {
            photoContainer.innerHTML = `
                <div class="aspect-[4/3] bg-gray-100 flex items-center justify-center border-2 border-dashed border-gray-300 rounded text-gray-300">1</div>
                <div class="aspect-[4/3] bg-gray-100 flex items-center justify-center border-2 border-dashed border-gray-300 rounded text-gray-300">2</div>
                <div class="aspect-[4/3] bg-gray-100 flex items-center justify-center border-2 border-dashed border-gray-300 rounded text-gray-300">3</div>
            `;
            downloadBtn.classList.add('hidden');
        }

        // Jalankan kamera saat load
        initCamera();

    </script>
</body>
</html>